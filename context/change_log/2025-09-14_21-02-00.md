# 네이밍 컨벤션 통일 (snake_case → camelCase) + 플러그인 v2.0 업그레이드

## 문제 분석

- 문제: 코드베이스 전체에서 snake_case와 camelCase가 혼재 사용되어 일관성 부족
  - JSON 파일: `e_type`, `time_offset`, `base_time` (snake_case)
  - TypeScript 파일: `displayTime`, `pluginChain`, `baseAspect` (camelCase)
  - JavaScript/TypeScript 표준에서 camelCase 권장하나 일부 핵심 필드만 snake_case 사용
  - 개발자 혼란과 타입 불일치 야기

- 추가 문제: 내장 플러그인과 외부 플러그인이 이원화되어 복잡성 증가
  - 렌더러가 내장/외부 플러그인을 구분 처리 (`isBuiltinPlugin`, `evaluateBuiltinPlugin`)
  - 중복 코드: 동일 기능의 플러그인이 내장(BuiltinV2.ts)과 외부(demo/plugins/)에 각각 존재
  - 유지보수 부담: 두 가지 플러그인 시스템 병행 관리

## 해결 방법

### 1. 네이밍 컨벤션 통일 (Breaking Change)
- 모든 v2.0 코드를 JavaScript/TypeScript 표준 camelCase로 통일:
  - `e_type` → `eType` (엘리먼트 타입 식별자)
  - `time_offset` → `timeOffset` (플러그인 시간 오프셋 범위)
  - `base_time` → `baseTime` (timeOffset 계산 기준 시간)

### 2. 전체 시스템 변경
- **타입 정의 업데이트**
  - `src/types/scenario-v2.ts`: BaseNode, ResolvedNode 인터페이스 수정
  - `src/types/plugin-v3.ts`: PluginSpec 인터페이스에 baseTime 필드 추가
  - `src/types/scenario.ts`: 레거시 타입도 일관성 유지

- **파서 및 렌더러 코어 수정**
  - `src/core/RendererV2.ts`: baseTime 우선순위 로직 정리 (`plugin.baseTime → node.baseTime → node.displayTime`)
  - `src/composer/PluginChainComposerV2.ts`: timeOffset 기반 플러그인 창 계산 로직 업데이트
  - `src/parser/FieldMigration.ts`: snake_case → camelCase 자동 변환 로직 추가

### 3. 내장 플러그인 제거 및 외부 플러그인 통합
- **내장 플러그인 완전 제거**
  - `src/runtime/plugins/BuiltinV2.ts`, `Builtin.ts` 파일 삭제
  - `RendererV2.ts`에서 `isBuiltinPlugin()`, `evaluateBuiltinPlugin()` 메서드 제거
  - 플러그인 타입 감지에서 'builtin' 타입 제거

- **외부 플러그인으로 통합**
  - fadeOut@2.0.0, pop@2.0.0, waveY@2.0.0, shakeX@2.0.0 신규 생성 (내장 → 외부 변환)
  - 기존 19개 외부 플러그인 v2.0.0으로 일괄 업그레이드
  - 모든 manifest.json 버전 필드 2.0.0 업데이트

### 4. 마이그레이션 및 호환성 지원
- **자동 변환 로직**
  - `FieldMigration.migrateV13ToV20()`: e_type, time_offset, base_time 자동 변환 추가
  - `CompatibilityLayer`: 런타임에서 혼재된 네이밍 자동 감지 및 변환
  - 하위 호환성 보장: 기존 snake_case 필드 자동으로 camelCase로 변환

## 영향 파일

### 핵심 시스템
- `src/types/*.ts`: 모든 타입 정의 파일
- `src/core/RendererV2.ts`: baseTime 우선순위 로직, eType 참조 수정
- `src/composer/PluginChainComposerV2.ts`: timeOffset 처리 로직
- `src/parser/FieldMigration.ts`: 마이그레이션 로직 확장

### JSON 샘플 파일
- `demo/samples/*.json`: 모든 v2.0 샘플 파일 (legacy 폴더 제외)
- `demo/plugin-server/plugins/*/manifest.json`: 모든 플러그인 매니페스트

### 문서 및 테스트
- `context/*.md`: 모든 문서에서 네이밍 통일
- `src/**/*.test.ts`: 모든 테스트 파일 업데이트

## 검증 포인트

### 타입 안전성
- ✅ TypeScript 컴파일 오류 없음 (`pnpm typecheck` 성공)
- ✅ 모든 인터페이스와 타입이 camelCase로 통일
- ✅ Define reference와 타입 캐스팅 오류 해결

### 기능 동작
- ✅ 376개 테스트 모두 통과 (FieldMigration 테스트 포함)
- ✅ 플러그인 시스템 단순화: 외부 플러그인만으로 통일 작동
- ✅ 샘플 파일들이 새로운 네이밍으로 정상 렌더링

### 마이그레이션 안전성
- ✅ 기존 snake_case 필드 자동 변환 확인
- ✅ v1.3 → v2.0 마이그레이션에서 네이밍 변환 포함
- ✅ CompatibilityLayer에서 런타임 호환성 제공

## 개선 효과

1. **일관성 확보**: 모든 v2.0 코드가 JavaScript/TypeScript 표준 camelCase 사용
2. **개발자 경험 향상**: 일관된 네이밍으로 인지 부담 감소
3. **아키텍처 단순화**: 플러그인 시스템 이원화 제거로 복잡도 감소
4. **유지보수성 개선**: 단일 플러그인 경로로 관리 복잡성 해소
5. **표준 준수**: 업계 표준 JavaScript 네이밍 컨벤션 완전 준수

## 마이그레이션 가이드

### 기존 v2.0 파일 업데이트 방법
```bash
# JSON 파일 일괄 변환
find . -name "*.json" -exec sed -i 's/"e_type"/"eType"/g' {} \;
find . -name "*.json" -exec sed -i 's/"time_offset"/"timeOffset"/g' {} \;
find . -name "*.json" -exec sed -i 's/"base_time"/"baseTime"/g' {} \;
```

### TypeScript 코드 업데이트 예시
```typescript
// Before (Breaking)
node.e_type === 'text'        // ❌ Property doesn't exist
plugin.time_offset           // ❌ Property doesn't exist

// After (Fixed)
node.eType === 'text'         // ✅ Correct camelCase
plugin.timeOffset            // ✅ Correct camelCase
```

이 변경으로 MotionText Renderer v2.0은 완전히 일관된 camelCase 네이밍 컨벤션을 갖춘 깔끔한 코드베이스가 되었습니다.