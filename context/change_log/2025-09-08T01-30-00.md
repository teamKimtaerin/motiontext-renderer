# 제목: rVFC 세대 토큰(generation) 도입 및 시작/재스케줄 정책 안정화

## 변경 배경
- seek/loadedmetadata 이후 vFC 콜백이 무효화되거나 교차 스케줄되어, 중복 예약·좀비 콜백 우려가 존재.
- 시작 정책을 attach-only로 정리했으나, 호출 시점의 가독성과 멱등 의도를 코드로 명시할 필요.

## 주요 변경
1) vFC 세대 토큰 도입
- `TimelineController`에 `vfcGen` 추가. `scheduleVfc()` 호출마다 세대 증가.
- 예약되는 콜백은 자신의 `gen`을 캡처하여 실행 시 `gen !== this.vfcGen`이면 즉시 반환(좀비 무시).
- 다음 프레임 재예약 시에도 동일 세대/실행 중 조건을 확인하여 단일 스트림 보장.

2) schedule/cancel 분리 및 호출 시점 명확화
- `cancelVfc()`/`scheduleVfc()` 분리 유지, `onSeeked`/`onLoadedMetadata`에서는 `running`일 때만 재스케줄 호출(의도 명확화).
- `play()`는 rVFC 지원 시 `scheduleVfc()`를 통해 예약(로직 일원화), 폴백은 rAF 유지.

3) 멱등 API 의도 강화
- `ensurePlaying()`/`ensureStopped()`가 내부 상태를 확인하고 `play()`/`pause()`를 호출하도록 수정(의도를 코드화).

## 코드 포인트
- `src/core/TimelineController.ts`
  - `vfcGen`/`vfcCb` 필드 추가
  - `scheduleVfc()` 내부에서 세대 증가 후 클로저 콜백 생성 및 예약
  - 콜백 내부에서 세대/실행 상태 확인 후 publish 및 재예약
  - `onSeekedBound`/`onLoadedMetaBound`에서 `if (running) scheduleVfc()`
  - `play()`가 `scheduleVfc()`를 사용하도록 변경
  - `ensurePlaying()`/`ensureStopped()` 상태 확인 후 호출

## 기대 효과
- 빠른 play/pause/seek/load 교차 상황에서도 vFC가 하나의 유효한 스트림으로 유지
- 좀비 콜백 및 중복 예약 방지, 재생 중 시킹 후 즉시 동기화되는 안정성 확보
- API 의도(멱등/attach-only)가 구현과 일관되게 반영

## 비고/후속
- 경계 테스트(세대 불일치 무시, 빠른 play/pause 반복, pause 중 seek 유지 등) 추가 권장
- rAF/vFC 드라이버 토글은 별도 이슈로 검토 가능

