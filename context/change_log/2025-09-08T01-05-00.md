# 제목: 타임라인 시작 정책(attach-only) 정리 및 rVFC 재스케줄 안정화

## 배경
- rVFC 전환 후, 재생 중 시킹/샘플 교체 시 vFC 콜백이 무효화되어 애니메이션이 멈추는 사례와, 시작 타이밍 중복/경합에 대한 우려가 제기됨.

## 변경 사항
1) 시작 정책 정리(attach-only)
- `loadConfig()`에서는 타임라인을 자동 시작하지 않음.
- `attachMedia()`에서 비디오가 이미 재생 중이면 멱등 API `ensurePlaying()`으로 안전 시작.

2) 멱등 API 도입(Tell, Don’t Ask)
- `TimelineController.ensurePlaying()` / `ensureStopped()` 추가.
- 외부는 상태 질의 없이 보장 호출만 수행(내부에서 멱등 처리).

3) rVFC 재스케줄 안정화
- `cancelVfc()`/`scheduleVfc()` 분리: 언제나 기존 예약을 취소 후 새로 예약하여 seek/load 이후 좀비 콜백 가능성 차단.
- `seeked`/`loadedmetadata`/`play` 이벤트 시 실행 중이면 `scheduleVfc()` 호출.
- `pause`/`ended`/`detach`에서는 `cancelVfc()`로 확실히 정리.

4) 구독 해제 방어
- `attachMedia()`에서 이전 구독 해제를 `try/finally`로 감싸 안전성 강화.

## 코드 포인트
- `src/index.ts:32` `loadConfig`의 자동 시작 제거.
- `src/index.ts:55` `attachMedia`에서 `ensurePlaying()` 사용, 이전 구독 안전 해제.
- `src/core/TimelineController.ts:14,19` 이벤트에서 `scheduleVfc()` 사용.
- `src/core/TimelineController.ts:104` `cancelVfc()`/`scheduleVfc()` 추가 및 사용.
- `src/core/TimelineController.ts:160` `ensurePlaying()`/`ensureStopped()` 추가.

## 결과/영향
- 재생 중 시킹/샘플 교체 후에도 rVFC 콜백이 안정적으로 이어짐.
- 시작 타이밍은 attach 경로로 일원화되어 중복 호출과 경합 가능성 축소.
- 기존 테스트 호환(유닛테스트 추가 변경 없이 통과 예상), 타입/빌드 무영향.

## 비고
- rVFC의 특성상 체감 프레임은 영상 fps에 동기화됨(정확도 우선). 데모에서 rAF 체감이 필요하다면 후속으로 driver 토글 옵션 도입 예정.

